'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var Vue = _interopDefault(require('vue'));
var compiler = require('vue-template-compiler');
var serverRenderer = require('vue-server-renderer');
var es2015compile = _interopDefault(require('vue-template-es2015-compiler'));

function compile$1(str, opts) {
  var ref = compiler.compile(str, opts);
  var renderBody = ref.render;
  var render = es2015compile(("function render() {" + renderBody + "}"));
  // eslint-disable-next-line no-new-func
  var renderFunction = new Function((render + ";return render.call(this);"));
  return function (locals) {
    if ( locals === void 0 ) locals = {};

    return new Promise(function (resolve, reject) {
      var component = {
        name: 'component',
        props: Object.keys(locals),
        render: renderFunction
      };
      var vm = new Vue({
        render: function render(h) {
          return h(component, { props: locals })
        }
      });
      var renderer = serverRenderer.createRenderer();
      renderer.renderToString(vm, function (err, html) {
        if (err) { return reject(err) }
        resolve(html);
      });
    })
  }
}

function render(str, locals, opts) {
  var template = compile$1(str, opts);
  return template(locals)
}

exports.compile = compile$1;
exports.render = render;
